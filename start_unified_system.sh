#!/bin/bash

echo "================================================"
echo "๐ ุชุดุบูู Marwan Hub Factories v3.0.0 - ุงููุธุงู ุงูููุญุฏ"
echo "================================================"
echo ""

# ุงูุชุญูู ูู ุชุซุจูุช Python
if ! command -v python3 &> /dev/null; then
    echo "โ Python3 ุบูุฑ ูุซุจุช. ุงูุฑุฌุงุก ุชุซุจูุชู ุฃููุงู."
    exit 1
fi

# ุงูุชุญูู ูู ุชุซุจูุช Rust
if ! command -v cargo &> /dev/null; then
    echo "โ๏ธ  Rust ุบูุฑ ูุซุจุช. ุณูุชู ุชุดุบูู ุงูุฎุงุฏู Python ููุท."
    RUST_AVAILABLE=false
else
    RUST_AVAILABLE=true
fi

# ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุงุฒูุฉ
echo "๐ ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุงุฒูุฉ..."
mkdir -p downloads exports products/{education,creative,corporate,technology}

# ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "๐๏ธ  ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
python3 database.py

# ุชููุฆุฉ ุจูุงูุงุช ุงููุตุงุฏูุฉ
echo "๐ ุชููุฆุฉ ูุธุงู ุงููุตุงุฏูุฉ..."
python3 -c "from auth_system import auth_system; print('โ ูุธุงู ุงููุตุงุฏูุฉ ุฌุงูุฒ')"

# ุชุดุบูู ุงููุธุงู ุงูููุญุฏ
echo "๐ ุชุดุบูู ุงูุฎุงุฏู ุงูููุญุฏ ุนูู ูููุฐ 8000..."
echo ""
echo "================================================"
echo "๐ ุฅุญุตุงุฆูุงุช ุงููุธุงู:"
echo "   ยท ุงููููุฐ: 8000"
echo "   ยท ุงููุณุงุฑ: $(pwd)"
echo "   ยท ุงูุฅุตุฏุงุฑ: v3.0.0"
echo "================================================"
echo ""
echo "๐ ุงูุฑูุงุจุท ุงููุชุงุญุฉ:"
echo "   ยท ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ: http://localhost:8000"
echo "   ยท ููุญุฉ ุงูุฅุฏุงุฑุฉ: http://localhost:8000/admin_dashboard.html"
echo "   ยท ููุญุฉ ุงูุชุญูู ุงููุจุงุดุฑุฉ: http://localhost:8000/dashboard_live.html"
echo "   ยท ูุงุฌูุฉ API: http://localhost:8000/api/factories"
echo ""
echo "๐ ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ:"
echo "   ยท ุงููุณุชุฎุฏู: admin / admin123"
echo "   ยท ุงููุณุชุฎุฏู: user / user123"
echo ""
echo "================================================"
echo "๐ ูุชุดุบูู ุงููุธุงูุ ุงุฎุชุฑ ุฃุญุฏ ุงูุฎูุงุฑุงุช:"
echo "   1. ุชุดุบูู ุงูุฎุงุฏู ุงูููุญุฏ (ููุตู ุจู)"
echo "   2. ุชุดุบูู ุงููุธุงู ุงููุงูู (Rust + Python)"
echo "   3. ุชุดุบูู ุฎุงุฏู ุงูุชูุฒูู ููุท"
echo "   4. ุงูุฎุฑูุฌ"
echo "================================================"

read -p "ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุฑูู ุงูุฎูุงุฑ [1]: " choice
choice=${choice:-1}

case $choice in
    1)
        echo "๐ ุชุดุบูู ุงูุฎุงุฏู ุงูููุญุฏ..."
        python3 unified_server_final.py
        ;;
    2)
        if [ "$RUST_AVAILABLE" = true ]; then
            echo "๐ ุชุดุบูู ุงููุธุงู ุงููุงูู..."
            # ุชุดุบูู Rust backend ูู ุงูุฎูููุฉ
            cargo run --bin api_server &
            RUST_PID=$!
            echo "๐ฆ ุฎูููุฉ Rust ุชุนูู ุจูุนุฑู ุงูุนูููุฉ: $RUST_PID"
            
            # ุชุดุบูู ุงูุฎุงุฏู ุงูููุญุฏ
            python3 unified_server_final.py
            
            # ุนูุฏ ุงูุฅุบูุงูุ ุฅููุงุก ุนูููุฉ Rust
            kill $RUST_PID 2>/dev/null
        else
            echo "โ Rust ุบูุฑ ูุชููุฑ. ุชุดุบูู ุงูุฎุงุฏู ุงูููุญุฏ ููุท..."
            python3 unified_server_final.py
        fi
        ;;
    3)
        echo "๐ฅ ุชุดุบูู ุฎุงุฏู ุงูุชูุฒูู..."
        python3 export_server.py
        ;;
    4)
        echo "๐ ูุน ุงูุณูุงูุฉ!"
        exit 0
        ;;
    *)
        echo "โ ุฎูุงุฑ ุบูุฑ ุตุงูุญ. ุชุดุบูู ุงูุฎุงุฏู ุงูููุญุฏ ุงูุชุฑุงุถูุงู..."
        python3 unified_server_final.py
        ;;
esac
