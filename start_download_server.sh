#!/bin/bash

echo "======================================================"
echo "ðŸ“¦ ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"
echo "======================================================"

# Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø®ÙˆØ§Ø¯Ù… Ù‚Ø¯ÙŠÙ…Ø©
echo "ðŸ§¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©..."
pkill -f "python3.*export_server\|python3.*9000" 2>/dev/null
sleep 2

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
echo "ðŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©..."
python3 create_test_products.py 2>/dev/null || echo "âš ï¸ ØªØ®Ø·ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"

# ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… Ø§Ù„ØªÙ†Ø²ÙŠÙ„
echo "ðŸš€ ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… Ø§Ù„ØªÙ†Ø²ÙŠÙ„ Ø¹Ù„Ù‰ Ù…Ù†ÙØ° 9000..."
python3 export_server.py &
SERVER_PID=$!

sleep 3

echo ""
echo "âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„! (PID: $SERVER_PID)"
echo ""
echo "ðŸŒ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ§Ø­Ø©:"
echo "   â€¢ ðŸ“¥ Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø²ÙŠÙ„:    http://localhost:9000/products"
echo "   â€¢ ðŸ“¤ Ø±ÙØ¹ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯:   http://localhost:9000/upload"
echo "   â€¢ ðŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: http://localhost:9000/"
echo ""
echo "ðŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…:"
curl -s http://localhost:9000/api/health | python3 -c "
import sys, json
try:
    data = json.load(sys.stdin)
    print('âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:', data.get('status', 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
    print('ðŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', data.get('products_count', 0))
    print('âœ¨ Ø§Ù„Ø¥ØµØ¯Ø§Ø±:', data.get('version', 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
except Exception as e:
    print('âŒ Ø®Ø·Ø£:', str(e))
" 2>/dev/null || echo "âš ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."

echo ""
echo "======================================================"
echo "ðŸŽ‰ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø²ÙŠÙ„ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!"
echo ""
echo "ðŸ“‹ Ù„Ù„Ø¨Ø¯Ø¡:"
echo "   1. Ø§ÙØªØ­ Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø²ÙŠÙ„: http://localhost:9000/products"
echo "   2. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†ØªØ¬ Ù„Ù„ØªÙ†Ø²ÙŠÙ„"
echo "   3. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙØ¹Ø© Ù„ØªÙ†Ø²ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø©"
echo "======================================================"

# ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­
echo ""
echo "ðŸŒ ÙØªØ­ Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø²ÙŠÙ„..."
termux-open-url "http://localhost:9000/products" 2>/dev/null

echo ""
echo "Press Ctrl+C to stop the server"
echo "======================================================"

wait
